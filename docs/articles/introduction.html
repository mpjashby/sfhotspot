<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to sfhotspot • sfhotspot</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to sfhotspot">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sfhotspot</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Introduction to sfhotspot</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mpjashby/sfhotspot/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to sfhotspot</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mpjashby/sfhotspot/blob/HEAD/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<p>sfhotspot is a package for understanding patterns in data that
represent points in space. You can use it to count points in different
places, estimate the density of points, show changes in the distribution
of points over time, identify places with more points than would be
expected by chance, and classify areas based on the number of points in
them during different periods.</p>
<p>The specific motivation for this package was to analyse the locations
of crimes, but the functions should be useful for understanding patterns
in points representing other features or events. The package is called
sfhotspot because it works with (and – where relevant – produces) SF
objects as produced by the <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> package. sfhotspot also
produces data that is <a href="https://tidyr.tidyverse.org/articles/tidy-data.html" class="external-link"><em>tidy</em></a>,
making it easy to use functions from packages such as <a href="https://dplyr.tidyverse.org/" class="external-link">dplyr</a> to filter the results,
etc.</p>
<p>All the functions in sfhotspot work on an SF data frame or tibble in
which each row in the data represents a single point (e.g. the location
of an event). In this introduction we will use the built-in
<code>memphis_robberies</code> dataset to show how each of the
<code>hotspot_*()</code> family of functions works.
<code>memphis_robberies</code> contains details of 2,245 robberies in
Memphis, Tennessee, in 2019.</p>
<table class="table">
<caption>The included <code>memphis_robberies</code> dataset</caption>
<colgroup>
<col width="13%">
<col width="24%">
<col width="28%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="right">uid</th>
<th align="left">offense_type</th>
<th align="left">date</th>
<th align="left">geometry</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">15213800</td>
<td align="left">personal robbery</td>
<td align="left">2019-01-01 03:30:00</td>
<td align="left">POINT (-89.942 35.149)</td>
</tr>
<tr class="even">
<td align="right">15214030</td>
<td align="left">personal robbery</td>
<td align="left">2019-01-01 22:00:00</td>
<td align="left">POINT (-89.86 35.059)</td>
</tr>
<tr class="odd">
<td align="right">15214042</td>
<td align="left">personal robbery</td>
<td align="left">2019-01-01 23:58:00</td>
<td align="left">POINT (-89.929 35.058)</td>
</tr>
<tr class="even">
<td align="right">15214050</td>
<td align="left">personal robbery</td>
<td align="left">2019-01-02 00:30:00</td>
<td align="left">POINT (-90.018 35.201)</td>
</tr>
<tr class="odd">
<td align="right">15214118</td>
<td align="left">personal robbery</td>
<td align="left">2019-01-02 11:38:00</td>
<td align="left">POINT (-89.96 35.14)</td>
</tr>
<tr class="even">
<td align="right">15214242</td>
<td align="left">personal robbery</td>
<td align="left">2019-01-02 20:50:00</td>
<td align="left">POINT (-89.953 35.159)</td>
</tr>
<tr class="odd">
<td align="right">15214290</td>
<td align="left">personal robbery</td>
<td align="left">2019-01-03 01:30:00</td>
<td align="left">POINT (-89.95 35.026)</td>
</tr>
<tr class="even">
<td align="right">15214295</td>
<td align="left">personal robbery</td>
<td align="left">2019-01-03 02:00:00</td>
<td align="left">POINT (-89.932 35.076)</td>
</tr>
<tr class="odd">
<td align="right">15214319</td>
<td align="left">personal robbery</td>
<td align="left">2019-01-03 05:00:00</td>
<td align="left">POINT (-90.021 35.033)</td>
</tr>
<tr class="even">
<td align="right">15214428</td>
<td align="left">personal robbery</td>
<td align="left">2019-01-03 16:45:00</td>
<td align="left">POINT (-90.032 35.165)</td>
</tr>
</tbody>
</table>
<p>We can plot this raw data, but the resulting plot is not very
informative (even with the points made semi-transparent), since there
are too many points to see clear patterns.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">memphis_robberies</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-3-1.png" alt="A very basic point map showing the locations of individual robberies in Memphis, TN. Each robbery is reprsented as a small, semi-transparent dot." width="80%" style="display: block; margin: auto;"></p>
<div class="section level2">
<h2 id="counting-points">Counting points<a class="anchor" aria-label="anchor" href="#counting-points"></a>
</h2>
<p>The <code><a href="../reference/hotspot_count.html">hotspot_count()</a></code> produces an SF object with counts
for the number of points in (by default) each cell in a grid of cells.
As with all the functions in the package, this can be customised in
various ways – see <em>Common arguments</em>, below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hotspot_count.html">hotspot_count</a></span><span class="op">(</span><span class="va">memphis_robberies</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cell size set to 0.00524 degrees automatically</span></span>
<span></span>
<span><span class="va">point_counts</span></span>
<span><span class="co">#&gt; Simple feature collection with 2926 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -90.1261 ymin: 34.99475 xmax: -89.72786 ymax: 35.26199</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,926 × 2</span></span></span>
<span><span class="co">#&gt;        n                                                                geometry</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                                                           <span style="color: #949494; font-style: italic;">&lt;POLYGON [°]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     0 ((-90.08418 34.99475, -90.07894 34.99475, -90.07894 34.99999, -90.0841…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     0 ((-90.07894 34.99475, -90.0737 34.99475, -90.0737 34.99999, -90.07894 …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     0 ((-90.0737 34.99475, -90.06846 34.99475, -90.06846 34.99999, -90.0737 …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     0 ((-90.06846 34.99475, -90.06322 34.99475, -90.06322 34.99999, -90.0684…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     0 ((-90.06322 34.99475, -90.05798 34.99475, -90.05798 34.99999, -90.0632…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     0 ((-90.05798 34.99475, -90.05274 34.99475, -90.05274 34.99999, -90.0579…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     0 ((-90.05274 34.99475, -90.0475 34.99475, -90.0475 34.99999, -90.05274 …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     0 ((-90.0475 34.99475, -90.04226 34.99475, -90.04226 34.99999, -90.0475 …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     0 ((-90.04226 34.99475, -90.03702 34.99475, -90.03702 34.99999, -90.0422…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     0 ((-90.03702 34.99475, -90.03178 34.99475, -90.03178 34.99999, -90.0370…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2,916 more rows</span></span></span></code></pre></div>
<p>We can then plot that grid of cells.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">n</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">point_counts</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>    colour <span class="op">=</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-5-1.png" alt="A basic map showing the count of robberies in each cell in a grid covering Memphis, TN. Grid cells with more robberies are shown in darker shades of blue, while those with fewer robberies are shown in lighter shades." width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="calculating-kernel-density">Calculating kernel density<a class="anchor" aria-label="anchor" href="#calculating-kernel-density"></a>
</h2>
<p>The <code><a href="../reference/hotspot_kde.html">hotspot_kde()</a></code> function can be used to calculate
kernel density estimates for each cell in a grid. The kernel density
estimation (KDE) can be customised using the <code>bandwidth</code> and
<code>bandwidth_adjust</code> arguments. This function also accepts the
argument explained in the <em>Common arguments</em> section, below.</p>
<p>If you do not specify any optional arguments,
<code><a href="../reference/hotspot_kde.html">hotspot_kde()</a></code> will try to choose reasonable default values.
The KDE algorithm requires projected co-ordinates (i.e. not longitudes
and latitudes), so we must first transform the data to use an
appropriate local projected co-ordinate system.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">robbery_kde</span> <span class="op">&lt;-</span> <span class="va">memphis_robberies</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="st">"EPSG:2843"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/hotspot_kde.html">hotspot_kde</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">robbery_kde</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Simple feature collection with 3301 features and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 223497.9 ymin: 80772.86 xmax: 260497.9 ymax: 110272.9</span></span>
<span><span class="co">#&gt; Projected CRS: NAD83(HARN) / Tennessee</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3,301 × 3</span></span></span>
<span><span class="co">#&gt;        n   kde                                                          geometry</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                                                     <span style="color: #949494; font-style: italic;">&lt;POLYGON [m]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     0  20.7 ((229497.9 80772.86, 229497.9 81272.86, 229997.9 81272.86, 22999…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     0  25.1 ((229997.9 80772.86, 229997.9 81272.86, 230497.9 81272.86, 23049…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     0  30.2 ((230497.9 80772.86, 230497.9 81272.86, 230997.9 81272.86, 23099…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     0  35.6 ((230997.9 80772.86, 230997.9 81272.86, 231497.9 81272.86, 23149…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     0  40.7 ((231497.9 80772.86, 231497.9 81272.86, 231997.9 81272.86, 23199…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     0  45.2 ((231997.9 80772.86, 231997.9 81272.86, 232497.9 81272.86, 23249…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     0  48.4 ((232497.9 80772.86, 232497.9 81272.86, 232997.9 81272.86, 23299…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     0  50.1 ((232997.9 80772.86, 232997.9 81272.86, 233497.9 81272.86, 23349…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     0  50.2 ((233497.9 80772.86, 233497.9 81272.86, 233997.9 81272.86, 23399…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     1  48.6 ((233997.9 80772.86, 233997.9 81272.86, 234497.9 81272.86, 23449…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3,291 more rows</span></span></span></code></pre>
<p>Again, we can plot the result.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">kde</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">robbery_kde</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>    colour <span class="op">=</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-8-1.png" alt="A hotspot map showing the density of robberies in each cell in a grid  covering Memphis, TN. Grid cells with higher densitites of robberies are  shown in darker shades of blue, while those with lower densities are shown  in lighter shades." width="80%" style="display: block; margin: auto;"></p>
<p>We can adjust the appearance of the KDE layer on this map by
specifying optional arguments to <code><a href="../reference/hotspot_kde.html">hotspot_kde()</a></code>. In
particular, the <code>bandwidth_adjust</code> argument is useful for
controlling the level of detail visible in the density layer – use
values of <code>bandwidth_adjust</code> below 1 to show more detail, and
values above 1 to show a smoother density surface.</p>
</div>
<div class="section level2">
<h2 id="common-arguments">Common arguments<a class="anchor" aria-label="anchor" href="#common-arguments"></a>
</h2>
<p>All the functions in this package work on a grid of cells, which can
be customised using one or more of these common arguments:</p>
<ul>
<li>
<code>cell_size</code> specifies the size of each equally spaced
grid cell, using the same units (metres, degrees, etc.) as used in the
sf data frame given in the data argument. Ignored if <code>grid</code>
is not <code>NULL</code>. If this argument and <code>grid</code> are
both <code>NULL</code> (the default), the cell size will be calculated
automatically.</li>
<li>
<code>grid_type</code> specifies whether the grid should be made up
of squares (“rect”, the default) or hexagons (“hex”). Ignored if
<code>grid</code> is not <code>NULL</code>.</li>
<li>
<code>grid</code> specifies an <code>sf</code> data frame containing
polygons, which will be used as the grid for which counts are made.</li>
<li>
<code>quiet</code> whether messages should be printed reporting the
values of any parameters (such as <code>cell_size</code>) that have been
set automatically.</li>
</ul>
<div class="section level3">
<h3 id="automatic-cell-size-selection">Automatic cell-size selection<a class="anchor" aria-label="anchor" href="#automatic-cell-size-selection"></a>
</h3>
<p>If <code>grid</code> and <code>cell_size</code> are both
<code>NULL</code>, the cell size will be set so that there are 50 cells
on the shorter side of the grid. If the data SF object is projected in
metres or feet, the number of cells will be adjusted upwards so that the
cell size is a multiple of 100.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matt Ashby.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
