<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate the relationship between the kernel density of two layers of points — hotspot_dual_kde • sfhotspot</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate the relationship between the kernel density of two layers of points — hotspot_dual_kde"><meta name="description" content="Estimate the relationship between the kernel density of two layers of points"><meta property="og:description" content="Estimate the relationship between the kernel density of two layers of points"><meta property="og:image" content="http://pkgs.lesscrime.info/sfhotspot/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sfhotspot</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction.html">Introduction to sfhotspot</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mpjashby/sfhotspot/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Estimate the relationship between the kernel density of two layers of points</h1>
      <small class="dont-index">Source: <a href="https://github.com/mpjashby/sfhotspot/blob/HEAD/R/hotspot_dual_kde.R" class="external-link"><code>R/hotspot_dual_kde.R</code></a></small>
      <div class="d-none name"><code>hotspot_dual_kde.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Estimate the relationship between the kernel density of two layers of points</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">hotspot_dual_kde</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  cell_size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  grid_type <span class="op">=</span> <span class="st">"rect"</span>,</span>
<span>  bandwidth <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bandwidth_adjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"ratio"</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  transform <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x-y">x, y<a class="anchor" aria-label="anchor" href="#arg-x-y"></a></dt>
<dd><p><code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf</a></code> data frames containing points.</p></dd>


<dt id="arg-cell-size">cell_size<a class="anchor" aria-label="anchor" href="#arg-cell-size"></a></dt>
<dd><p><code>numeric</code> value specifying the size of each equally
spaced grid cell, using the same units (metres, degrees, etc.) as used in
the <code>sf</code> data frame given in the <code>x</code> argument. Ignored if
<code>grid</code> is not <code>NULL</code>. If this argument and <code>grid</code> are
<code>NULL</code> (the default), the cell size will be calculated automatically
(see Details).</p></dd>


<dt id="arg-grid-type">grid_type<a class="anchor" aria-label="anchor" href="#arg-grid-type"></a></dt>
<dd><p><code>character</code> specifying whether the grid should be made
up of squares (<code>"rect"</code>, the default) or hexagons (<code>"hex"</code>).
Ignored if <code>grid</code> is not <code>NULL</code>.</p></dd>


<dt id="arg-bandwidth">bandwidth<a class="anchor" aria-label="anchor" href="#arg-bandwidth"></a></dt>
<dd><p>either a single <code>numeric</code> value specifying the
bandwidth to be used in calculating the kernel density estimates, or a list
of exactly 2 such values. If this argument is <code>NULL</code> (the default),
the bandwidth for both <code>x</code> and <code>y</code> will be determined
automatically using the result of <code><a href="https://rdrr.io/pkg/MASS/man/bandwidth.nrd.html" class="external-link">bandwidth.nrd</a></code> called
on the co-ordinates of the points in <code>x</code>. If this argument is
<code>list(NULL, NULL)</code>, separate bandwidths will be determined
automatically for <code>x</code> and <code>y</code> based on each layer.</p></dd>


<dt id="arg-bandwidth-adjust">bandwidth_adjust<a class="anchor" aria-label="anchor" href="#arg-bandwidth-adjust"></a></dt>
<dd><p>single positive <code>numeric</code> value by which the
value of <code>bandwidth</code> for both <code>x</code> and <code>y</code> will be
multiplied, or a list of two such values. Useful for setting the bandwidth
relative to the default.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p><code>character</code> specifying the method by which the densities,
<code>d()</code>, of <code>x</code> and <code>y</code> will be related:</p><dl><dt><code>ratio</code></dt>
<dd><p>(the default) calculates the density of <code>x</code>
divided by the density of <code>y</code>, i.e. <code>d(x) / d(y)</code>.</p></dd>

<dt><code>log</code></dt>
<dd><p>calculates the natural logarithm of the density of
<code>x</code> divided by the density of <code>y</code>, i.e.
<code>log(d(x) / d(y))</code>.</p></dd>

<dt><code>diff</code></dt>
<dd><p>calculates the difference between the density of
<code>x</code> and the density of <code>y</code>, i.e. <code>d(x) - d(y)</code>.</p></dd>

<dt><code>sum</code></dt>
<dd><p>calculates the sum of the density of <code>x</code> and the
density of <code>y</code>, i.e. <code>d(x) + d(y)</code>.</p></dd>


</dl><p>The result of this calculation will be returned in the <code>kde</code> column of
the return value.</p></dd>


<dt id="arg-grid">grid<a class="anchor" aria-label="anchor" href="#arg-grid"></a></dt>
<dd><p><code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf</a></code> data frame containing polygons, which will
be used as the grid for which densities are estimated.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p><code>NULL</code> (the default) or a vector of length two giving
either <code>NULL</code> or the name of a column in each of <code>x</code> and
<code>y</code> to be used as weights for weighted counts and KDE values.</p></dd>


<dt id="arg-transform">transform<a class="anchor" aria-label="anchor" href="#arg-transform"></a></dt>
<dd><p>the underlying SpatialKDE package cannot calculate kernel
density for lon/lat data, so this must be transformed to use a projected
co-ordinate reference system. If this argument is <code>TRUE</code> (the
default) and <code>sf::st_is_longlat(x)</code> is <code>TRUE</code>, <code>x</code>, <code>y</code>
and <code>grid</code> (if provided) will be transformed automatically using
<code>link{st_transform_auto}</code> before the kernel density is estimated and
transformed back afterwards. Set this argument to <code>FALSE</code> to suppress
automatic transformation of the data.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>if set to <code>TRUE</code>, messages reporting the values of any
parameters set automatically will be suppressed. The default is
<code>FALSE</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Further arguments passed to <code><a href="https://rdrr.io/pkg/SpatialKDE/man/kde.html" class="external-link">kde</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An <code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf</a></code> tibble of grid cells with corresponding point
counts and dual kernel density estimates for each cell. This can be plotted
using <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></code>.</p>
<p>This function creates a regular two-dimensional grid of cells (unless a
custom grid is specified with <code>grid</code>), calculates the density of points
in each cell for each of <code>x</code> and <code>y</code> using functions from the
<code>SpatialKDE</code> package, then produces a value representing a relation
between the two densities. The count of points in each cell is also returned.</p>
<p>Dual kernel density values can be useful for understanding the relationship
between the distributions of two sets of point locations. For example:</p><ul><li><p>The ratio between two densities representing the locations of burglaries
and the locations of houses can show the distribution of the risk
(incidence rate) of burglaries. The logged ratio may be useful to show
relationships where one set of points has an extremely skewed
distribution.</p></li>
<li><p>The difference between two densities can show the change in distributions
between two points in time.</p></li>
<li><p>The sum of two densities can be used to estimate the total density of two
types of point, e.g. the locations of occurrences of two diseases.</p></li>
</ul><div class="section">
<h3 id="coverage-of-the-output-data">Coverage of the output data<a class="anchor" aria-label="anchor" href="#coverage-of-the-output-data"></a></h3>


<p>The grid produced by this function covers the convex hull of the points in
<code>x</code>. This means the result may include KDE values for cells that are
outside the area for which data were provided, which could be misleading. To
handle this, consider cropping the output layer to the area for which data
are available. For example, if you only have crime data for a particular
district, crop the output dataset to the district boundary using
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></code>.</p>
</div>

<div class="section">
<h3 id="automatic-cell-size-selection">Automatic cell-size selection<a class="anchor" aria-label="anchor" href="#automatic-cell-size-selection"></a></h3>


<p>If no cell size is given then the cell size will be set so that there are 50
cells on the shorter side of the grid. If the <code>x</code> SF object is projected
in metres or feet, the number of cells will be adjusted upwards so that the
cell size is a multiple of 100.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Yin, P. (2020). Kernels and Density Estimation. <em>The Geographic
Information Science &amp; Technology Body of Knowledge</em> (1st Quarter 2020
Edition), John P. Wilson (ed.).
doi:<a href="https://doi.org/10.22224/gistbok/2020.1.12" class="external-link">doi:10.22224/gistbok/2020.1.12</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># See also the examples for `hotspot_kde()` for examples of how to specify</span></span></span>
<span class="r-in"><span><span class="co"># `cell_size`, `bandwidth`, etc.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Transform data to UTM zone 15N so that cell_size and bandwidth can be set</span></span></span>
<span class="r-in"><span><span class="co"># in metres</span></span></span>
<span class="r-in"><span><span class="va">memphis_robberies_utm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">memphis_robberies</span>, <span class="fl">32615</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">memphis_population_utm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">memphis_population</span>, <span class="fl">32615</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate burglary risk based on residential population. `weights` is set</span></span></span>
<span class="r-in"><span><span class="co"># to `c(NULL, population)` so that the robberies layer is not weighted and</span></span></span>
<span class="r-in"><span><span class="co"># the population layer is weighted according to the number of residents in</span></span></span>
<span class="r-in"><span><span class="co"># each census block.</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="fu">hotspot_dual_kde</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">memphis_robberies_utm</span>,</span></span>
<span class="r-in"><span>  <span class="va">memphis_population_utm</span>,</span></span>
<span class="r-in"><span>  bandwidth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="cn">NULL</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="va">population</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Cell size set to 500 metres automatically</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Bandwidth set automatically based on rule of thumb.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Bandwidth for `x` = 5,592 metres.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Bandwidth set automatically based on rule of thumb.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Bandwidth for `y` = 5,175 metres.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Simple feature collection with 3302 features and 2 fields</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Geometry type: POLYGON</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dimension:     XY</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bounding box:  xmin: 761931.5 ymin: 3876436 xmax: 797931.5 ymax: 3906436</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Projected CRS: WGS 84 / UTM zone 15N</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 3,302 × 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        n     kde                                                        geometry</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                                                   <span style="color: #949494; font-style: italic;">&lt;POLYGON [m]&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>     0 0.002<span style="text-decoration: underline;">28</span> ((762931.5 3876436, 762931.5 3876936, 763431.5 3876936, 763431…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>     0 0.002<span style="text-decoration: underline;">14</span> ((763431.5 3876436, 763431.5 3876936, 763931.5 3876936, 763931…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>     0 0.002<span style="text-decoration: underline;">03</span> ((763931.5 3876436, 763931.5 3876936, 764431.5 3876936, 764431…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>     0 0.001<span style="text-decoration: underline;">94</span> ((764431.5 3876436, 764431.5 3876936, 764931.5 3876936, 764931…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>     0 0.001<span style="text-decoration: underline;">88</span> ((764931.5 3876436, 764931.5 3876936, 765431.5 3876936, 765431…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>     0 0.001<span style="text-decoration: underline;">85</span> ((765431.5 3876436, 765431.5 3876936, 765931.5 3876936, 765931…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>     0 0.001<span style="text-decoration: underline;">84</span> ((765931.5 3876436, 765931.5 3876936, 766431.5 3876936, 766431…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>     0 0.001<span style="text-decoration: underline;">85</span> ((766431.5 3876436, 766431.5 3876936, 766931.5 3876936, 766931…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>     0 0.001<span style="text-decoration: underline;">88</span> ((766931.5 3876436, 766931.5 3876936, 767431.5 3876936, 767431…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>     0 0.001<span style="text-decoration: underline;">95</span> ((767431.5 3876436, 767431.5 3876936, 767931.5 3876936, 767931…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 3,292 more rows</span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matt Ashby.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

